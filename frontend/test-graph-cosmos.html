<!DOCTYPE html>
<html>
<head>
    <title>Test Graph and Cosmos</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #333; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        #graph-test { width: 100%; height: 400px; border: 1px solid #666; margin: 20px 0; }
        .split-test { display: flex; gap: 10px; height: 300px; border: 1px solid #666; }
        .panel { border: 1px solid #444; padding: 10px; overflow: auto; }
        .left-panel { width: 30%; background: #2a2a2a; }
        .right-panel { width: 70%; background: #222; }
        .left-panel-40 { width: 40%; background: #2a2a2a; }
        .right-panel-60 { width: 60%; background: #222; }
    </style>
    <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
</head>
<body>
    <h1>Testing Graph and Cosmos Issues</h1>
    
    <div class="test">
        <h3>1. Graph API Test</h3>
        <button onclick="testGraphAPI()">Test Graph API</button>
        <div id="graph-api-result"></div>
    </div>
    
    <div class="test">
        <h3>2. Graph Visualization Test</h3>
        <button onclick="testGraphVisualization()">Load Graph Visualization</button>
        <div id="graph-test"></div>
    </div>
    
    <div class="test">
        <h3>3. Cosmos Layout Test - 30/70 Split (Original)</h3>
        <div class="split-test">
            <div class="panel left-panel">
                <h4>Left Panel (30%)</h4>
                <p>Container List</p>
                <p>This is too narrow for proper visibility</p>
            </div>
            <div class="panel right-panel">
                <h4>Right Panel (70%)</h4>
                <p>Document List</p>
            </div>
        </div>
    </div>
    
    <div class="test">
        <h3>4. Cosmos Layout Test - 40/60 Split (New)</h3>
        <div class="split-test">
            <div class="panel left-panel-40">
                <h4>Left Panel (40%)</h4>
                <p>Container List</p>
                <p>This should be more readable</p>
            </div>
            <div class="panel right-panel-60">
                <h4>Right Panel (60%)</h4>
                <p>Document List</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8420/api/v1';
        
        async function testGraphAPI() {
            const resultDiv = document.getElementById('graph-api-result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                const response = await fetch(`${API_BASE}/graph/data`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                resultDiv.innerHTML = `
                    <div class="success">✓ API Response OK</div>
                    <div>Nodes: ${data.nodes ? data.nodes.length : 0}</div>
                    <div>Edges: ${data.edges ? data.edges.length : 0}</div>
                    <div>Layout: ${data.layout || 'none'}</div>
                    <details>
                        <summary>Raw Data</summary>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </details>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">✗ Error: ${error.message}</div>`;
                console.error('Graph API Error:', error);
            }
        }
        
        async function testGraphVisualization() {
            const container = document.getElementById('graph-test');
            container.innerHTML = 'Loading...';
            
            try {
                const response = await fetch(`${API_BASE}/graph/data`);
                const data = await response.json();
                
                if (!data.nodes || !data.edges) {
                    throw new Error('Invalid graph data structure');
                }
                
                container.innerHTML = ''; // Clear loading message
                
                // Initialize Cytoscape
                const cy = cytoscape({
                    container: container,
                    
                    elements: {
                        nodes: data.nodes,
                        edges: data.edges
                    },
                    
                    style: [
                        {
                            selector: 'node',
                            style: {
                                'background-color': '#666',
                                'label': 'data(label)',
                                'color': '#fff',
                                'text-valign': 'center',
                                'text-halign': 'center'
                            }
                        },
                        {
                            selector: 'edge',
                            style: {
                                'width': 2,
                                'line-color': '#999',
                                'target-arrow-color': '#999',
                                'target-arrow-shape': 'triangle',
                                'label': 'data(label)',
                                'font-size': '10px'
                            }
                        }
                    ],
                    
                    layout: {
                        name: 'breadthfirst',
                        directed: true,
                        padding: 10
                    }
                });
                
                console.log('Cytoscape initialized:', cy);
                
            } catch (error) {
                container.innerHTML = `<div class="error">✗ Visualization Error: ${error.message}</div>`;
                console.error('Graph Visualization Error:', error);
            }
        }
        
        // Auto-run tests
        testGraphAPI();
    </script>
</body>
</html>